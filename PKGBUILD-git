# Maintainer: Your Name <your.email@example.com>
pkgname=optiscaler-universal-git
pkgver=r50.179fdf7
pkgrel=1
pkgdesc="Intelligent OptiScaler configuration tool for Linux gaming (development version)"
arch=('any')
url="https://github.com/ind4skylivey/0ptiscaler4linux"
license=('MIT')
depends=('bash>=4.0' 'pciutils')
makedepends=('git')
optdepends=(
    'mesa-utils: for Mesa/AMD/Intel GPU detection'
    'git-lfs: for downloading OptiScaler binaries'
    'python: for advanced YAML parsing'
)
provides=('optiscaler-universal')
conflicts=('optiscaler-universal')
source=("git+$url.git")
sha256sums=('SKIP')

pkgver() {
    cd "$srcdir/0ptiscaler4linux"
    printf "r%s.%s" "$(git rev-list --count HEAD)" "$(git rev-parse --short HEAD)"
}

package() {
    cd "$srcdir/0ptiscaler4linux"
    
    # Create directories
    install -dm755 "$pkgdir/usr/share/optiscaler-universal"
    install -dm755 "$pkgdir/usr/bin"
    install -dm755 "$pkgdir/usr/share/doc/optiscaler-universal"
    install -dm755 "$pkgdir/usr/share/licenses/optiscaler-universal"
    
    # Install core files
    cp -r core "$pkgdir/usr/share/optiscaler-universal/"
    cp -r lib "$pkgdir/usr/share/optiscaler-universal/"
    cp -r profiles "$pkgdir/usr/share/optiscaler-universal/"
    cp -r scripts "$pkgdir/usr/share/optiscaler-universal/"
    cp -r templates "$pkgdir/usr/share/optiscaler-universal/"
    
    # Install binaries directory structure
    install -dm755 "$pkgdir/usr/share/optiscaler-universal/binaries"
    cp -r binaries/* "$pkgdir/usr/share/optiscaler-universal/binaries/"
    
    # Create symlinks in /usr/bin
    ln -s "/usr/share/optiscaler-universal/scripts/install.sh" "$pkgdir/usr/bin/optiscaler-install"
    ln -s "/usr/share/optiscaler-universal/scripts/uninstall.sh" "$pkgdir/usr/bin/optiscaler-uninstall"
    ln -s "/usr/share/optiscaler-universal/scripts/update.sh" "$pkgdir/usr/bin/optiscaler-update"
    ln -s "/usr/share/optiscaler-universal/scripts/diagnose.sh" "$pkgdir/usr/bin/optiscaler-diagnose"
    ln -s "/usr/share/optiscaler-universal/scripts/benchmark.sh" "$pkgdir/usr/bin/optiscaler-benchmark"
    
    # Install documentation
    cp -r docs/* "$pkgdir/usr/share/doc/optiscaler-universal/"
    install -Dm644 README.md "$pkgdir/usr/share/doc/optiscaler-universal/README.md"
    install -Dm644 PROJECT_DESIGN.md "$pkgdir/usr/share/doc/optiscaler-universal/PROJECT_DESIGN.md"
    install -Dm644 PROJECT_STATUS.md "$pkgdir/usr/share/doc/optiscaler-universal/PROJECT_STATUS.md"
    
    # Install license
    install -Dm644 LICENSE "$pkgdir/usr/share/licenses/optiscaler-universal/LICENSE"
    
    # Install version file
    install -Dm644 VERSION "$pkgdir/usr/share/optiscaler-universal/VERSION"
}
